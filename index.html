<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    <style>
        /* –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∞—à–µ–≥–æ style.css */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .chat-container {
            width: 100%;
            max-width: 600px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            height: 90vh;
        }
        /* ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ ... */
        button:hover {
            background-color: #0C6B58;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <header>
            <h1>WebSocket –ß–∞—Ç</h1>
            <div class="user-info">
                <input type="text" id="username" placeholder="–í–∞—à–µ –∏–º—è" value="–ê–Ω–æ–Ω–∏–º">
            </div>
        </header>

        <div class="chat-box" id="chatBox"></div>

        <div class="input-area">
            <input type="text" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
            <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <script>
        // –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∞—à–µ–≥–æ script.js
        // –ù–ï –ó–ê–ë–£–î–¨–¢–ï –ü–û–î–°–¢–ê–í–ò–¢–¨ –í–ê–® REALNY URL!
        const socket = new WebSocket('https://nexus-o4sw.onrender.com');
        const chatBox = document.getElementById('chatBox');
        const messageInput = document.getElementById('messageInput');
        const usernameInput = document.getElementById('username');

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        socket.onopen = function(event) {
            console.log('‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            addMessageToChat('–°–∏—Å—Ç–µ–º–∞', '–í—ã –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ —á–∞—Ç—É.', 'system');
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);

            if (data.type === 'history') {
                data.data.forEach(msg => {
                    addMessageToChat(msg.user, msg.text, msg.user === usernameInput.value ? 'me' : 'other', msg.time);
                });
            } else if (data.type === 'message') {
                const msg = data.data;
                addMessageToChat(msg.user, msg.text, msg.user === usernameInput.value ? 'me' : 'other', msg.time);
            }
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
        socket.onerror = function(error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ WebSocket:', error);
            addMessageToChat('–°–∏—Å—Ç–µ–º–∞', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.', 'system');
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        socket.onclose = function(event) {
            console.log('üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ', event);
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        function sendMessage() {
            const messageText = messageInput.value.trim();
            const user = usernameInput.value.trim() || '–ê–Ω–æ–Ω–∏–º';

            if (messageText && socket.readyState === WebSocket.OPEN) {
                const messageData = {
                    user: user,
                    text: messageText
                };
                socket.send(JSON.stringify(messageData));
                messageInput.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                console.log('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:', messageData);
            } else {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å. –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:', socket.readyState);
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –Ω–∞–∂–∞—Ç–∏—é Enter
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function addMessageToChat(user, text, type, time = new Date().toLocaleTimeString()) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.classList.add(type === 'me' ? 'my-message' : 'other-message');

            const messageHTML = `
                <div>${text}</div>
                <div class="message-info">${user}, ${time}</div>
            `;
            messageElement.innerHTML = messageHTML;
            chatBox.appendChild(messageElement);
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —á–∞—Ç –≤–Ω–∏–∑ –∫ –Ω–æ–≤–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
</body>
</html>
